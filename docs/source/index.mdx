<!-- DISABLE-FRONTMATTER-SECTIONS -->

<div class="flex justify-center">
    <img class="block dark:hidden" src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/safetensors/safetensors-logo-light.svg"/>
    <img class="hidden dark:block" src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/safetensors/safetensors-logo-dark.svg"/>
</div>

# Safetensors

Safetensors is a new simple format for storing tensors safely (as opposed to pickle) and that is still fast (zero-copy). Safetensors is really [fast ðŸš€](./speed).

## Installation

with pip:
```
pip install safetensors
```

with conda:
```
conda install -c huggingface safetensors
```

## Usage

### Load tensors

```python
from safetensors import safe_open

tensors = {}
with safe_open("model.safetensors", framework="pt", device=0) as f:
    for k in f.keys():
        tensors[k] = f.get_tensor(k)
```

Loading only part of the tensors (interesting when running on multiple GPU)

```python
from safetensors import safe_open

tensors = {}
with safe_open("model.safetensors", framework="pt", device=0) as f:
    tensor_slice = f.get_slice("embedding")
    vocab_size, hidden_dim = tensor_slice.get_shape()
    tensor = tensor_slice[:, :hidden_dim]
```

### Save tensors

```python
import torch
from safetensors.torch import save_file

tensors = {
    "embedding": torch.zeros((2, 2)),
    "attention": torch.zeros((2, 3))
}
save_file(tensors, "model.safetensors")
```

## Format

Let's say you have safetensors file named `model.safetensors`, then `model.safetensors` will have the following internal format:

<table>
<colgroup>
<col span="1" style="width: 20%;">
<col span="1" style="width: 80%;">
</colgroup>
<tbody>
<tr class="hidden">
<th>Bytes</th>
<th>Description</th>
</tr>
<tr>
<td>
8 bytes
</td>
<td>

`N = u64` int containing the size of the header

</td>
</tr>
<tr>
<td>
N bytes
</td>
<td>

JSON utf-8 string representing the header

<div style="max-width: 20rem;">

```json
{
    "TENSOR_NAME_1": {
        "dtype": "F16", // can be one of ["F64","F32","F16","BF16","I64","I32","I16","I8","U8","BOOL"]
        "shape": [1, 16, 256],
        "offsets": [BEGIN, END]
    },
    "TENSOR_NAME_2": {...},
        ...,
    "__metadata__": {...} // special key for storing free form text-to-text map
}
```

</div>

</td>
</tr>
<tr>
<td>
rest of the file
</td>
<td>
Byte buffer that is the tensors data
</td>
</tr>
</tbody>
</table>